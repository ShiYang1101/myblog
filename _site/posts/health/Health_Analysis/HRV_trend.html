<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Most interesting blog on Earth! â€“ hrv_trend</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Most interesting blog on Earth!</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html">
 <span class="menu-text">Aetius Lee</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ShiYang1101"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/shi-yang-lee"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> SGDRegressor</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autogluon.tabular <span class="im">import</span> TabularDataset, TabularPredictor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>run fitbit_generate_daily_hrv.ipynb</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>hrv_raw <span class="op">=</span> pd.read_csv(<span class="st">'./Fitbit/ShiYangLee/Sleep/daily_hrv_full.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>hrv_raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>timestamp</th>
      <th>rmssd</th>
      <th>nremhr</th>
      <th>entropy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-02-27T00:00:00</td>
      <td>52.053</td>
      <td>53.789</td>
      <td>2.833</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-02-28T00:00:00</td>
      <td>61.281</td>
      <td>49.983</td>
      <td>2.935</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-03-01T00:00:00</td>
      <td>59.392</td>
      <td>50.798</td>
      <td>2.943</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-03-02T00:00:00</td>
      <td>56.437</td>
      <td>54.837</td>
      <td>2.829</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022-03-03T00:00:00</td>
      <td>54.982</td>
      <td>52.368</td>
      <td>2.927</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>87</th>
      <td>2022-05-31T00:00:00</td>
      <td>47.665</td>
      <td>56.233</td>
      <td>2.883</td>
    </tr>
    <tr>
      <th>88</th>
      <td>2022-06-01T00:00:00</td>
      <td>56.450</td>
      <td>52.769</td>
      <td>2.938</td>
    </tr>
    <tr>
      <th>89</th>
      <td>2022-06-02T00:00:00</td>
      <td>51.455</td>
      <td>56.017</td>
      <td>2.938</td>
    </tr>
    <tr>
      <th>90</th>
      <td>2022-06-03T00:00:00</td>
      <td>52.935</td>
      <td>54.560</td>
      <td>2.840</td>
    </tr>
    <tr>
      <th>91</th>
      <td>2022-06-04T00:00:00</td>
      <td>52.431</td>
      <td>55.384</td>
      <td>2.882</td>
    </tr>
  </tbody>
</table>
<p>92 rows Ã— 4 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>hrv_raw.set_index(<span class="st">'timestamp'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hrv_raw.index <span class="op">=</span> pd.to_datetime(hrv_raw.index, <span class="bu">format</span> <span class="op">=</span> <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hrv_raw.index = hrv_raw.index.to_series().dt.strftime('%Y-%m-%d')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>hrv_raw[<span class="st">'rmssd'</span>].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>&lt;AxesSubplot:xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-6-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>hrv_raw[<span class="st">'hrv_rolling'</span>] <span class="op">=</span> hrv_raw[<span class="st">'rmssd'</span>].rolling(<span class="dv">7</span>, <span class="dv">3</span>, center <span class="op">=</span> <span class="va">True</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hrv_raw[[<span class="st">'rmssd'</span>, <span class="st">'hrv_rolling'</span>]].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>&lt;AxesSubplot:xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>run fitbit_generate_steps.ipynb</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>steps_raw <span class="op">=</span> pd.read_csv(<span class="st">'./Fitbit/ShiYangLee/Physical Activity/steps_full.csv'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>steps_raw.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>dateTime</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-02-26 22:15:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-02-26 22:16:00</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-02-26 22:17:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-02-26 22:18:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022-02-26 22:19:00</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>steps_raw.set_index(<span class="st">'dateTime'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>steps_raw.index <span class="op">=</span> pd.to_datetime(steps_raw.index)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>steps_per_day <span class="op">=</span> steps_raw.groupby(steps_raw.index.to_series().dt.date).<span class="bu">sum</span>()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>steps_per_day.index <span class="op">=</span> pd.to_datetime(steps_per_day.index)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>steps_per_day.columns <span class="op">=</span> [<span class="st">'steps'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>steps_per_day.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>steps</th>
    </tr>
    <tr>
      <th>dateTime</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-26</th>
      <td>60</td>
    </tr>
    <tr>
      <th>2022-02-27</th>
      <td>2542</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>6426</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>9602</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>7721</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>hrv <span class="op">=</span> hrv_raw.merge(steps_per_day, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hrv[<span class="st">'steps_normalized'</span>] <span class="op">=</span> hrv[<span class="st">'steps'</span>]<span class="op">/</span><span class="dv">100</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>hrv[<span class="st">'steps_rolling'</span>] <span class="op">=</span> hrv[<span class="st">'steps_normalized'</span>].rolling(<span class="dv">7</span>, <span class="dv">3</span>, center <span class="op">=</span> <span class="va">True</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hrv[[<span class="st">'hrv_rolling'</span>, <span class="st">'steps_rolling'</span>]].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sleep_dir <span class="op">=</span> glob.glob(<span class="st">'./Fitbit/ShiYangLee/Sleep/sleep-*.json'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> sleep_dir:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.read_json(<span class="bu">file</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    dfs.append(data)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>sleep <span class="op">=</span> pd.concat(dfs, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>sleep.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>logId</th>
      <th>dateOfSleep</th>
      <th>startTime</th>
      <th>endTime</th>
      <th>duration</th>
      <th>minutesToFallAsleep</th>
      <th>minutesAsleep</th>
      <th>minutesAwake</th>
      <th>minutesAfterWakeup</th>
      <th>timeInBed</th>
      <th>efficiency</th>
      <th>type</th>
      <th>infoCode</th>
      <th>logType</th>
      <th>levels</th>
      <th>mainSleep</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>36651127171</td>
      <td>2022-04-26</td>
      <td>2022-04-25T23:59:00.000</td>
      <td>2022-04-26T07:53:30.000</td>
      <td>28440000</td>
      <td>0</td>
      <td>419</td>
      <td>55</td>
      <td>0</td>
      <td>474</td>
      <td>96</td>
      <td>stages</td>
      <td>0</td>
      <td>auto_detected</td>
      <td>{'summary': {'deep': {'count': 4, 'minutes': 8...</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36638185772</td>
      <td>2022-04-25</td>
      <td>2022-04-25T01:04:00.000</td>
      <td>2022-04-25T07:43:30.000</td>
      <td>23940000</td>
      <td>0</td>
      <td>339</td>
      <td>60</td>
      <td>6</td>
      <td>399</td>
      <td>95</td>
      <td>stages</td>
      <td>0</td>
      <td>auto_detected</td>
      <td>{'summary': {'deep': {'count': 6, 'minutes': 7...</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>36625185402</td>
      <td>2022-04-24</td>
      <td>2022-04-23T22:20:30.000</td>
      <td>2022-04-24T09:35:30.000</td>
      <td>40500000</td>
      <td>0</td>
      <td>568</td>
      <td>107</td>
      <td>0</td>
      <td>675</td>
      <td>96</td>
      <td>stages</td>
      <td>0</td>
      <td>auto_detected</td>
      <td>{'summary': {'deep': {'count': 5, 'minutes': 9...</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>36617451798</td>
      <td>2022-04-23</td>
      <td>2022-04-23T13:25:00.000</td>
      <td>2022-04-23T14:56:00.000</td>
      <td>5460000</td>
      <td>0</td>
      <td>80</td>
      <td>11</td>
      <td>0</td>
      <td>91</td>
      <td>88</td>
      <td>classic</td>
      <td>2</td>
      <td>auto_detected</td>
      <td>{'summary': {'restless': {'count': 4, 'minutes...</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>36613912467</td>
      <td>2022-04-23</td>
      <td>2022-04-22T23:23:00.000</td>
      <td>2022-04-23T11:20:30.000</td>
      <td>43020000</td>
      <td>0</td>
      <td>623</td>
      <td>94</td>
      <td>0</td>
      <td>717</td>
      <td>93</td>
      <td>stages</td>
      <td>0</td>
      <td>auto_detected</td>
      <td>{'summary': {'deep': {'count': 7, 'minutes': 1...</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>json_struct <span class="op">=</span> json.loads(sleep.to_json(orient<span class="op">=</span><span class="st">'records'</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>sleep <span class="op">=</span> pd.json_normalize(json_struct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sleep.drop([<span class="st">'levels.data'</span>, <span class="st">'levels.shortData'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sleep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>logId</th>
      <th>dateOfSleep</th>
      <th>startTime</th>
      <th>endTime</th>
      <th>duration</th>
      <th>minutesToFallAsleep</th>
      <th>minutesAsleep</th>
      <th>minutesAwake</th>
      <th>minutesAfterWakeup</th>
      <th>timeInBed</th>
      <th>...</th>
      <th>levels.summary.light.thirtyDayAvgMinutes</th>
      <th>levels.summary.rem.count</th>
      <th>levels.summary.rem.minutes</th>
      <th>levels.summary.rem.thirtyDayAvgMinutes</th>
      <th>levels.summary.restless.count</th>
      <th>levels.summary.restless.minutes</th>
      <th>levels.summary.awake.count</th>
      <th>levels.summary.awake.minutes</th>
      <th>levels.summary.asleep.count</th>
      <th>levels.summary.asleep.minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>36651127171</td>
      <td>2022-04-26</td>
      <td>2022-04-25T23:59:00.000</td>
      <td>2022-04-26T07:53:30.000</td>
      <td>28440000</td>
      <td>0</td>
      <td>419</td>
      <td>55</td>
      <td>0</td>
      <td>474</td>
      <td>...</td>
      <td>271.0</td>
      <td>6.0</td>
      <td>89.0</td>
      <td>101.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36638185772</td>
      <td>2022-04-25</td>
      <td>2022-04-25T01:04:00.000</td>
      <td>2022-04-25T07:43:30.000</td>
      <td>23940000</td>
      <td>0</td>
      <td>339</td>
      <td>60</td>
      <td>6</td>
      <td>399</td>
      <td>...</td>
      <td>273.0</td>
      <td>5.0</td>
      <td>61.0</td>
      <td>103.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>36625185402</td>
      <td>2022-04-24</td>
      <td>2022-04-23T22:20:30.000</td>
      <td>2022-04-24T09:35:30.000</td>
      <td>40500000</td>
      <td>0</td>
      <td>568</td>
      <td>107</td>
      <td>0</td>
      <td>675</td>
      <td>...</td>
      <td>271.0</td>
      <td>14.0</td>
      <td>143.0</td>
      <td>101.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>36617451798</td>
      <td>2022-04-23</td>
      <td>2022-04-23T13:25:00.000</td>
      <td>2022-04-23T14:56:00.000</td>
      <td>5460000</td>
      <td>0</td>
      <td>80</td>
      <td>11</td>
      <td>0</td>
      <td>91</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>36613912467</td>
      <td>2022-04-23</td>
      <td>2022-04-22T23:23:00.000</td>
      <td>2022-04-23T11:20:30.000</td>
      <td>43020000</td>
      <td>0</td>
      <td>623</td>
      <td>94</td>
      <td>0</td>
      <td>717</td>
      <td>...</td>
      <td>269.0</td>
      <td>12.0</td>
      <td>153.0</td>
      <td>99.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>119</th>
      <td>37092507425</td>
      <td>2022-05-31</td>
      <td>2022-05-31T00:40:00.000</td>
      <td>2022-05-31T08:39:00.000</td>
      <td>28740000</td>
      <td>0</td>
      <td>425</td>
      <td>54</td>
      <td>1</td>
      <td>479</td>
      <td>...</td>
      <td>251.0</td>
      <td>4.0</td>
      <td>133.0</td>
      <td>143.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>120</th>
      <td>37087272653</td>
      <td>2022-05-30</td>
      <td>2022-05-30T18:45:00.000</td>
      <td>2022-05-30T19:54:30.000</td>
      <td>4140000</td>
      <td>0</td>
      <td>64</td>
      <td>5</td>
      <td>0</td>
      <td>69</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>64.0</td>
    </tr>
    <tr>
      <th>121</th>
      <td>37054307750</td>
      <td>2022-05-28</td>
      <td>2022-05-27T23:15:00.000</td>
      <td>2022-05-28T09:38:00.000</td>
      <td>37380000</td>
      <td>0</td>
      <td>548</td>
      <td>75</td>
      <td>6</td>
      <td>623</td>
      <td>...</td>
      <td>235.0</td>
      <td>12.0</td>
      <td>154.0</td>
      <td>138.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>122</th>
      <td>37044773607</td>
      <td>2022-05-27</td>
      <td>2022-05-27T00:46:00.000</td>
      <td>2022-05-27T09:15:30.000</td>
      <td>30540000</td>
      <td>0</td>
      <td>470</td>
      <td>39</td>
      <td>0</td>
      <td>509</td>
      <td>...</td>
      <td>208.0</td>
      <td>9.0</td>
      <td>113.0</td>
      <td>162.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>123</th>
      <td>37030691168</td>
      <td>2022-05-26</td>
      <td>2022-05-26T00:18:30.000</td>
      <td>2022-05-26T09:11:00.000</td>
      <td>31920000</td>
      <td>0</td>
      <td>479</td>
      <td>53</td>
      <td>5</td>
      <td>532</td>
      <td>...</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>162.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>124 rows Ã— 33 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>sleep.to_csv(<span class="st">'sleep_tmp.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sleep <span class="op">=</span> sleep[<span class="op">~</span>sleep.duplicated(subset<span class="op">=</span><span class="st">'logId'</span>, keep<span class="op">=</span><span class="st">'last'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sleep_duration_df <span class="op">=</span> sleep.set_index(<span class="st">'dateOfSleep'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sleep_duration_df.index <span class="op">=</span> pd.to_datetime(sleep_duration_df.index)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sleep_duration_df.index.dtype)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>sleep_duration_df <span class="op">=</span> sleep_duration_df[<span class="st">'minutesAsleep'</span>].groupby(sleep_duration_df.index.to_series().dt.date).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>datetime64[ns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>sleep_duration_df.sort_index(inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>hrv <span class="op">=</span> hrv.merge(sleep_duration_df, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hrv[<span class="st">'minutesAsleep_normalized'</span>] <span class="op">=</span> hrv[<span class="st">'minutesAsleep'</span>]<span class="op">/</span><span class="dv">10</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>hrv[<span class="st">'minutesAsleep_rolling'</span>] <span class="op">=</span> hrv[<span class="st">'minutesAsleep_normalized'</span>].rolling(<span class="dv">7</span>, <span class="dv">3</span>, center<span class="op">=</span><span class="va">True</span>)<span class="op">\</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                .mean()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>hrv.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>rmssd</th>
      <th>nremhr</th>
      <th>entropy</th>
      <th>hrv_rolling</th>
      <th>steps</th>
      <th>steps_normalized</th>
      <th>steps_rolling</th>
      <th>minutesAsleep</th>
      <th>minutesAsleep_normalized</th>
      <th>minutesAsleep_rolling</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-27</th>
      <td>52.053</td>
      <td>53.789</td>
      <td>2.833</td>
      <td>57.290750</td>
      <td>2542</td>
      <td>25.42</td>
      <td>65.727500</td>
      <td>395</td>
      <td>39.5</td>
      <td>35.950000</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>61.281</td>
      <td>49.983</td>
      <td>2.935</td>
      <td>56.829000</td>
      <td>6426</td>
      <td>64.26</td>
      <td>74.984000</td>
      <td>328</td>
      <td>32.8</td>
      <td>34.500000</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>59.392</td>
      <td>50.798</td>
      <td>2.943</td>
      <td>57.001500</td>
      <td>9602</td>
      <td>96.02</td>
      <td>73.248333</td>
      <td>321</td>
      <td>32.1</td>
      <td>35.333333</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>56.437</td>
      <td>54.837</td>
      <td>2.829</td>
      <td>56.220143</td>
      <td>7721</td>
      <td>77.21</td>
      <td>65.765714</td>
      <td>394</td>
      <td>39.4</td>
      <td>38.057143</td>
    </tr>
    <tr>
      <th>2022-03-03</th>
      <td>54.982</td>
      <td>52.368</td>
      <td>2.927</td>
      <td>58.457857</td>
      <td>11201</td>
      <td>112.01</td>
      <td>66.738571</td>
      <td>287</td>
      <td>28.7</td>
      <td>39.114286</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>hrv[[<span class="st">'hrv_rolling'</span>, <span class="st">'steps_rolling'</span>, <span class="st">'minutesAsleep_rolling'</span>]].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_hrz_df():</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    hrz_dir <span class="op">=</span> glob.glob(<span class="st">'./Fitbit/ShiYangLee/Physical Activity/time_in_heart_rate_zones-*.json'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> hrz_dir:</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">=</span> pd.read_json(<span class="bu">file</span>, orient<span class="op">=</span><span class="st">'values'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        dfs.append(tmp)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    hrz_df <span class="op">=</span> pd.concat(dfs, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    hrz_df <span class="op">=</span> pd.concat([hrz_df, pd.json_normalize(hrz_df[<span class="st">'value'</span>])], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    hrz_df.drop(<span class="st">'value'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    hrz_df.set_index(<span class="st">'dateTime'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    hrz_df.sort_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    hrz_df.rename(columns <span class="op">=</span> {<span class="st">'valuesInZones.BELOW_DEFAULT_ZONE_1'</span>:<span class="st">'Resting_minutes'</span>, <span class="op">\</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                             <span class="st">'valuesInZones.IN_DEFAULT_ZONE_1'</span>:<span class="st">'Fat_burn_minutes'</span>, <span class="op">\</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                             <span class="st">'valuesInZones.IN_DEFAULT_ZONE_2'</span>:<span class="st">'Cardio_minutes'</span>, <span class="op">\</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                             <span class="st">'valuesInZones.IN_DEFAULT_ZONE_3'</span>:<span class="st">'Peak_minutes'</span>}, <span class="op">\</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                  inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hrz_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>hrz_df <span class="op">=</span> get_hrz_df()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>hrz_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Fat_burn_minutes</th>
      <th>Cardio_minutes</th>
      <th>Peak_minutes</th>
      <th>Resting_minutes</th>
    </tr>
    <tr>
      <th>dateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-26</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>109.0</td>
    </tr>
    <tr>
      <th>2022-02-27</th>
      <td>49.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1375.0</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>74.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1327.0</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>301.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1133.0</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>63.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1318.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>hrv <span class="op">=</span> hrv.merge(hrz_df, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>hrv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>rmssd</th>
      <th>nremhr</th>
      <th>entropy</th>
      <th>hrv_rolling</th>
      <th>steps</th>
      <th>steps_normalized</th>
      <th>steps_rolling</th>
      <th>minutesAsleep</th>
      <th>minutesAsleep_normalized</th>
      <th>minutesAsleep_rolling</th>
      <th>Fat_burn_minutes</th>
      <th>Cardio_minutes</th>
      <th>Peak_minutes</th>
      <th>Resting_minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-27</th>
      <td>52.053</td>
      <td>53.789</td>
      <td>2.833</td>
      <td>57.290750</td>
      <td>2542</td>
      <td>25.42</td>
      <td>65.727500</td>
      <td>395</td>
      <td>39.5</td>
      <td>35.950000</td>
      <td>49.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1375.0</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>61.281</td>
      <td>49.983</td>
      <td>2.935</td>
      <td>56.829000</td>
      <td>6426</td>
      <td>64.26</td>
      <td>74.984000</td>
      <td>328</td>
      <td>32.8</td>
      <td>34.500000</td>
      <td>74.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1327.0</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>59.392</td>
      <td>50.798</td>
      <td>2.943</td>
      <td>57.001500</td>
      <td>9602</td>
      <td>96.02</td>
      <td>73.248333</td>
      <td>321</td>
      <td>32.1</td>
      <td>35.333333</td>
      <td>301.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1133.0</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>56.437</td>
      <td>54.837</td>
      <td>2.829</td>
      <td>56.220143</td>
      <td>7721</td>
      <td>77.21</td>
      <td>65.765714</td>
      <td>394</td>
      <td>39.4</td>
      <td>38.057143</td>
      <td>63.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1318.0</td>
    </tr>
    <tr>
      <th>2022-03-03</th>
      <td>54.982</td>
      <td>52.368</td>
      <td>2.927</td>
      <td>58.457857</td>
      <td>11201</td>
      <td>112.01</td>
      <td>66.738571</td>
      <td>287</td>
      <td>28.7</td>
      <td>39.114286</td>
      <td>134.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1261.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-31</th>
      <td>47.665</td>
      <td>56.233</td>
      <td>2.883</td>
      <td>54.501571</td>
      <td>2925</td>
      <td>29.25</td>
      <td>36.010000</td>
      <td>425</td>
      <td>42.5</td>
      <td>49.257143</td>
      <td>48.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1199.0</td>
    </tr>
    <tr>
      <th>2022-06-01</th>
      <td>56.450</td>
      <td>52.769</td>
      <td>2.938</td>
      <td>54.392000</td>
      <td>15028</td>
      <td>150.28</td>
      <td>33.932857</td>
      <td>334</td>
      <td>33.4</td>
      <td>49.942857</td>
      <td>519.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>908.0</td>
    </tr>
    <tr>
      <th>2022-06-02</th>
      <td>51.455</td>
      <td>56.017</td>
      <td>2.938</td>
      <td>52.701833</td>
      <td>563</td>
      <td>5.63</td>
      <td>37.328333</td>
      <td>573</td>
      <td>57.3</td>
      <td>50.433333</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>862.0</td>
    </tr>
    <tr>
      <th>2022-06-03</th>
      <td>52.935</td>
      <td>54.560</td>
      <td>2.840</td>
      <td>52.187200</td>
      <td>3215</td>
      <td>32.15</td>
      <td>43.846000</td>
      <td>619</td>
      <td>61.9</td>
      <td>49.560000</td>
      <td>187.0</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>1044.0</td>
    </tr>
    <tr>
      <th>2022-06-04</th>
      <td>52.431</td>
      <td>55.384</td>
      <td>2.882</td>
      <td>53.317750</td>
      <td>192</td>
      <td>1.92</td>
      <td>47.495000</td>
      <td>527</td>
      <td>52.7</td>
      <td>51.325000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>647.0</td>
    </tr>
  </tbody>
</table>
<p>92 rows Ã— 14 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>lag_list <span class="op">=</span> [<span class="st">'steps'</span>, <span class="st">'minutesAsleep'</span>, <span class="st">'Cardio_minutes'</span>, <span class="st">'Resting_minutes'</span>, <span class="op">\</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Peak_minutes'</span>, <span class="st">'Fat_burn_minutes'</span>, <span class="st">'rmssd'</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_lag(df, lag_list, num_lag <span class="op">=</span> <span class="dv">10</span>):</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> lag_list:</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.join([df[col].shift(x).rename(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_lag</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">"</span>) <span class="op">\</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_lag<span class="op">+</span><span class="dv">1</span>)])</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lag_df <span class="op">=</span> get_lag(hrv, lag_list)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>lag_df.head()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>lag_df.to_csv(<span class="st">'hrv_features_data.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_partial_date(df, num):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    duration <span class="op">=</span> df.index[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> df.index[<span class="dv">0</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.to_datetime(df.index[<span class="dv">0</span>] <span class="op">+</span> num <span class="op">*</span> pd.to_timedelta(duration))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>split_date <span class="op">=</span> get_partial_date(lag_df, <span class="fl">0.7</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fearue_df <span class="op">=</span> lag_df.drop(columns<span class="op">=</span>[<span class="st">'rmssd'</span>, <span class="st">'nremhr'</span>, <span class="st">'entropy'</span>, <span class="st">'hrv_rolling'</span>, <span class="st">'steps_normalized'</span>, <span class="op">\</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'steps_rolling'</span>, <span class="st">'minutesAsleep_normalized'</span>, <span class="st">'minutesAsleep_rolling'</span>])</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>fearue_df <span class="op">=</span> fearue_df.interpolate(limit_direction<span class="op">=</span><span class="st">'backward'</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>target_df <span class="op">=</span> lag_df[<span class="st">'rmssd'</span>]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>train_feature_df <span class="op">=</span> fearue_df[fearue_df.index <span class="op">&lt;</span> split_date]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>train_target_df <span class="op">=</span> target_df[target_df.index <span class="op">&lt;</span> split_date]</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>test_feature_df <span class="op">=</span> fearue_df[fearue_df.index <span class="op">&gt;=</span> split_date]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>test_target_df <span class="op">=</span> target_df[target_df.index <span class="op">&gt;=</span> split_date]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearRegression(positive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>model.fit(X<span class="op">=</span> train_feature_df, y <span class="op">=</span> train_target_df)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>lag_df_pred <span class="op">=</span> model.predict(test_feature_df)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>train_pred <span class="op">=</span> model.predict(train_feature_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>lag_df_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>array([ 21.4760811 ,  29.58051799,   5.07399493,  49.88034677,
        26.88276033,   3.32142635,  19.71257407,   4.001742  ,
        31.23574041,  28.49397365,  30.95724303,  19.25458662,
        23.97663512,  41.23938159,   4.81121581,  31.24529391,
        28.51225889,  47.72197601,  37.13287846,  55.83223294,
        32.45460002,  40.07110786,  43.10763371,  40.67618983,
        41.78430693, -20.36163224])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(train_target_df, pd.DataFrame):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    train_target_df <span class="op">=</span> train_target_df.to_frame()</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(test_target_df,  pd.DataFrame):</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    test_target_df <span class="op">=</span> test_target_df.to_frame()</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>train_target_df[<span class="st">'pred'</span>] <span class="op">=</span> train_pred</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>test_target_df[<span class="st">'pred'</span>] <span class="op">=</span> lag_df_pred</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> pd.concat([train_target_df, test_target_df])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>model.score(test_feature_df, test_target_df[<span class="st">'rmssd'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<pre><code>-20.537318991809833</code></pre>
</div>
</div>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">8</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>plt.plot(final_df, label <span class="op">=</span> [<span class="st">'True_value'</span>,<span class="st">'Prediction'</span>])</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'DateTime'</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'HRV'</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>plt.vlines(split_date, ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'HRV_prediction.jpeg'</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">10</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>coef <span class="op">=</span> pd.DataFrame(<span class="bu">zip</span>(train_feature_df.columns, model.coef_), columns <span class="op">=</span> [<span class="st">'variables'</span>, <span class="st">'coefficients'</span>])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>coef <span class="op">=</span> coef.sort_values(<span class="st">'coefficients'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>coef.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>variables</th>
      <th>coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>53</th>
      <td>Peak_minutes_lag8</td>
      <td>3.845761</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Peak_minutes_lag4</td>
      <td>2.655873</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Cardio_minutes</td>
      <td>1.277758</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Peak_minutes_lag9</td>
      <td>0.937208</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Cardio_minutes_lag2</td>
      <td>0.542156</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Cardio_minutes_lag7</td>
      <td>0.440441</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Cardio_minutes_lag9</td>
      <td>0.398409</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Cardio_minutes_lag3</td>
      <td>0.245885</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Cardio_minutes_lag10</td>
      <td>0.233890</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Peak_minutes</td>
      <td>0.145260</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>bar <span class="op">=</span> lag_df[coef[<span class="st">'variables'</span>][:<span class="dv">10</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>bar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Peak_minutes_lag8</th>
      <th>Peak_minutes_lag4</th>
      <th>Cardio_minutes</th>
      <th>Peak_minutes_lag9</th>
      <th>Cardio_minutes_lag2</th>
      <th>Cardio_minutes_lag7</th>
      <th>Cardio_minutes_lag9</th>
      <th>Cardio_minutes_lag3</th>
      <th>Cardio_minutes_lag10</th>
      <th>Peak_minutes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-27</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-03-03</th>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-31</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-06-01</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-06-02</th>
      <td>8.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-06-03</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>8.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022-06-04</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>92 rows Ã— 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plt.figure(<span class="dv">1</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>plt.plot(final_df, label <span class="op">=</span> [<span class="st">'True_value'</span>,<span class="st">'Prediction'</span>])</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.figure(<span class="dv">2</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>bar.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 576x576 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-41-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>normalized_df<span class="op">=</span>(lag_df<span class="op">-</span>lag_df.<span class="bu">min</span>())<span class="op">/</span>(lag_df.<span class="bu">max</span>()<span class="op">-</span>lag_df.<span class="bu">min</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>split_date <span class="op">=</span> get_partial_date(lag_df, <span class="fl">0.7</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>norm_fearue_df <span class="op">=</span> lag_df.drop(columns<span class="op">=</span>[<span class="st">'rmssd'</span>, <span class="st">'nremhr'</span>, <span class="st">'entropy'</span>, <span class="st">'hrv_rolling'</span>, <span class="st">'steps_normalized'</span>, <span class="op">\</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'steps_rolling'</span>, <span class="st">'minutesAsleep_normalized'</span>, <span class="st">'minutesAsleep_rolling'</span>])</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>norm_fearue_df <span class="op">=</span> norm_fearue_df.interpolate(limit_direction<span class="op">=</span><span class="st">'backward'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>norm_target_df <span class="op">=</span> normalized_df[<span class="st">'rmssd'</span>]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>norm_train_feature_df <span class="op">=</span> norm_fearue_df[fearue_df.index <span class="op">&lt;</span> split_date]</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>norm_train_target_df <span class="op">=</span> norm_target_df[target_df.index <span class="op">&lt;</span> split_date]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>norm_test_feature_df <span class="op">=</span> norm_fearue_df[fearue_df.index <span class="op">&gt;=</span> split_date]</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>norm_test_target_df <span class="op">=</span> norm_target_df[target_df.index <span class="op">&gt;=</span> split_date]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>norm_model <span class="op">=</span> LinearRegression(positive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>norm_model.fit(X<span class="op">=</span> norm_train_feature_df, y <span class="op">=</span> norm_train_target_df)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>norm_lag_df_pred <span class="op">=</span> norm_model.predict(norm_test_feature_df)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>norm_train_pred <span class="op">=</span> norm_model.predict(norm_train_feature_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(norm_train_target_df, pd.DataFrame):</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    norm_train_target_df <span class="op">=</span> norm_train_target_df.to_frame()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(norm_test_target_df,  pd.DataFrame):</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    norm_test_target_df <span class="op">=</span> norm_test_target_df.to_frame()</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>norm_train_target_df[<span class="st">'pred'</span>] <span class="op">=</span> norm_train_pred</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>norm_test_target_df[<span class="st">'pred'</span>] <span class="op">=</span> norm_lag_df_pred</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>norm_final_df <span class="op">=</span> pd.concat([norm_train_target_df, norm_test_target_df])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>plt.plot(norm_final_df, label <span class="op">=</span> [<span class="st">'True_value'</span>,<span class="st">'Prediction'</span>])</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'DateTime'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'HRV'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.vlines(split_date, ymin=0, ymax=80)</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'HRV_prediction.jpeg'</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-46-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>norm_coef <span class="op">=</span> pd.DataFrame(<span class="bu">zip</span>(norm_train_feature_df.columns, norm_model.coef_), columns <span class="op">=</span> [<span class="st">'variables'</span>, <span class="st">'coefficients'</span>])</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>norm_coef <span class="op">=</span> norm_coef.sort_values(<span class="st">'coefficients'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>norm_coef.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>variables</th>
      <th>coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>53</th>
      <td>Peak_minutes_lag8</td>
      <td>0.094125</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Peak_minutes_lag4</td>
      <td>0.065003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Cardio_minutes</td>
      <td>0.031273</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Peak_minutes_lag9</td>
      <td>0.022938</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Cardio_minutes_lag2</td>
      <td>0.013269</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Cardio_minutes_lag7</td>
      <td>0.010780</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Cardio_minutes_lag9</td>
      <td>0.009751</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Cardio_minutes_lag3</td>
      <td>0.006018</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Cardio_minutes_lag10</td>
      <td>0.005724</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Peak_minutes</td>
      <td>0.003555</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>):</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Lag </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> correlation is: "</span>, lag_df[<span class="st">'rmssd'</span>].autocorr(lag<span class="op">=</span>i))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lag 1 correlation is:  0.34025622457976207
Lag 2 correlation is:  0.13093410406826045
Lag 3 correlation is:  0.2899652330054049
Lag 4 correlation is:  0.17777560211414647
Lag 5 correlation is:  0.01891563472475311
Lag 6 correlation is:  0.12297582512597087
Lag 7 correlation is:  -0.027419420021947822
Lag 8 correlation is:  0.01314137893812063
Lag 9 correlation is:  0.09586721928741726
Lag 10 correlation is:  -0.10188226779722838</code></pre>
</div>
</div>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>lag_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>rmssd</th>
      <th>nremhr</th>
      <th>entropy</th>
      <th>hrv_rolling</th>
      <th>steps</th>
      <th>steps_normalized</th>
      <th>steps_rolling</th>
      <th>minutesAsleep</th>
      <th>minutesAsleep_normalized</th>
      <th>minutesAsleep_rolling</th>
      <th>...</th>
      <th>rmssd_lag1</th>
      <th>rmssd_lag2</th>
      <th>rmssd_lag3</th>
      <th>rmssd_lag4</th>
      <th>rmssd_lag5</th>
      <th>rmssd_lag6</th>
      <th>rmssd_lag7</th>
      <th>rmssd_lag8</th>
      <th>rmssd_lag9</th>
      <th>rmssd_lag10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-27</th>
      <td>52.053</td>
      <td>53.789</td>
      <td>2.833</td>
      <td>57.290750</td>
      <td>2542</td>
      <td>25.42</td>
      <td>65.727500</td>
      <td>395</td>
      <td>39.5</td>
      <td>35.950000</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>61.281</td>
      <td>49.983</td>
      <td>2.935</td>
      <td>56.829000</td>
      <td>6426</td>
      <td>64.26</td>
      <td>74.984000</td>
      <td>328</td>
      <td>32.8</td>
      <td>34.500000</td>
      <td>...</td>
      <td>52.053</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>59.392</td>
      <td>50.798</td>
      <td>2.943</td>
      <td>57.001500</td>
      <td>9602</td>
      <td>96.02</td>
      <td>73.248333</td>
      <td>321</td>
      <td>32.1</td>
      <td>35.333333</td>
      <td>...</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>56.437</td>
      <td>54.837</td>
      <td>2.829</td>
      <td>56.220143</td>
      <td>7721</td>
      <td>77.21</td>
      <td>65.765714</td>
      <td>394</td>
      <td>39.4</td>
      <td>38.057143</td>
      <td>...</td>
      <td>59.392</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2022-03-03</th>
      <td>54.982</td>
      <td>52.368</td>
      <td>2.927</td>
      <td>58.457857</td>
      <td>11201</td>
      <td>112.01</td>
      <td>66.738571</td>
      <td>287</td>
      <td>28.7</td>
      <td>39.114286</td>
      <td>...</td>
      <td>56.437</td>
      <td>59.392</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-31</th>
      <td>47.665</td>
      <td>56.233</td>
      <td>2.883</td>
      <td>54.501571</td>
      <td>2925</td>
      <td>29.25</td>
      <td>36.010000</td>
      <td>425</td>
      <td>42.5</td>
      <td>49.257143</td>
      <td>...</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
      <td>59.480</td>
      <td>56.305</td>
    </tr>
    <tr>
      <th>2022-06-01</th>
      <td>56.450</td>
      <td>52.769</td>
      <td>2.938</td>
      <td>54.392000</td>
      <td>15028</td>
      <td>150.28</td>
      <td>33.932857</td>
      <td>334</td>
      <td>33.4</td>
      <td>49.942857</td>
      <td>...</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
      <td>59.480</td>
    </tr>
    <tr>
      <th>2022-06-02</th>
      <td>51.455</td>
      <td>56.017</td>
      <td>2.938</td>
      <td>52.701833</td>
      <td>563</td>
      <td>5.63</td>
      <td>37.328333</td>
      <td>573</td>
      <td>57.3</td>
      <td>50.433333</td>
      <td>...</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
    </tr>
    <tr>
      <th>2022-06-03</th>
      <td>52.935</td>
      <td>54.560</td>
      <td>2.840</td>
      <td>52.187200</td>
      <td>3215</td>
      <td>32.15</td>
      <td>43.846000</td>
      <td>619</td>
      <td>61.9</td>
      <td>49.560000</td>
      <td>...</td>
      <td>51.455</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
    </tr>
    <tr>
      <th>2022-06-04</th>
      <td>52.431</td>
      <td>55.384</td>
      <td>2.882</td>
      <td>53.317750</td>
      <td>192</td>
      <td>1.92</td>
      <td>47.495000</td>
      <td>527</td>
      <td>52.7</td>
      <td>51.325000</td>
      <td>...</td>
      <td>52.935</td>
      <td>51.455</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
    </tr>
  </tbody>
</table>
<p>92 rows Ã— 84 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>poly <span class="op">=</span> PolynomialFeatures(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fearue_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>steps</th>
      <th>minutesAsleep</th>
      <th>Fat_burn_minutes</th>
      <th>Cardio_minutes</th>
      <th>Peak_minutes</th>
      <th>Resting_minutes</th>
      <th>steps_lag1</th>
      <th>steps_lag2</th>
      <th>steps_lag3</th>
      <th>steps_lag4</th>
      <th>...</th>
      <th>rmssd_lag1</th>
      <th>rmssd_lag2</th>
      <th>rmssd_lag3</th>
      <th>rmssd_lag4</th>
      <th>rmssd_lag5</th>
      <th>rmssd_lag6</th>
      <th>rmssd_lag7</th>
      <th>rmssd_lag8</th>
      <th>rmssd_lag9</th>
      <th>rmssd_lag10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-27</th>
      <td>2542</td>
      <td>395</td>
      <td>49.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1375.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>6426</td>
      <td>328</td>
      <td>74.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1327.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>9602</td>
      <td>321</td>
      <td>301.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1133.0</td>
      <td>6426.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>7721</td>
      <td>394</td>
      <td>63.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1318.0</td>
      <td>9602.0</td>
      <td>6426.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>59.392</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-03</th>
      <td>11201</td>
      <td>287</td>
      <td>134.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1261.0</td>
      <td>7721.0</td>
      <td>9602.0</td>
      <td>6426.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>56.437</td>
      <td>59.392</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-31</th>
      <td>2925</td>
      <td>425</td>
      <td>48.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1199.0</td>
      <td>474.0</td>
      <td>1356.0</td>
      <td>1646.0</td>
      <td>2765.0</td>
      <td>...</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
      <td>59.480</td>
      <td>56.305</td>
    </tr>
    <tr>
      <th>2022-06-01</th>
      <td>15028</td>
      <td>334</td>
      <td>519.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>908.0</td>
      <td>2925.0</td>
      <td>474.0</td>
      <td>1356.0</td>
      <td>1646.0</td>
      <td>...</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
      <td>59.480</td>
    </tr>
    <tr>
      <th>2022-06-02</th>
      <td>563</td>
      <td>573</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>862.0</td>
      <td>15028.0</td>
      <td>2925.0</td>
      <td>474.0</td>
      <td>1356.0</td>
      <td>...</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
    </tr>
    <tr>
      <th>2022-06-03</th>
      <td>3215</td>
      <td>619</td>
      <td>187.0</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>1044.0</td>
      <td>563.0</td>
      <td>15028.0</td>
      <td>2925.0</td>
      <td>474.0</td>
      <td>...</td>
      <td>51.455</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
    </tr>
    <tr>
      <th>2022-06-04</th>
      <td>192</td>
      <td>527</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>647.0</td>
      <td>3215.0</td>
      <td>563.0</td>
      <td>15028.0</td>
      <td>2925.0</td>
      <td>...</td>
      <td>52.935</td>
      <td>51.455</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
    </tr>
  </tbody>
</table>
<p>92 rows Ã— 76 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>poly_df <span class="op">=</span> poly.fit_transform(train_feature_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(poly_df[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<pre><code>3003</code></pre>
</div>
</div>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(poly_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="148">
<pre><code>66</code></pre>
</div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>poly_model <span class="op">=</span> LinearRegression()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>poly_model.fit(poly_df, train_target_df[<span class="st">'rmssd'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">
<pre><code>LinearRegression()</code></pre>
</div>
</div>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>poly_full_df <span class="op">=</span> poly.fit_transform(fearue_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>poly_pred <span class="op">=</span> poly_model.predict(poly_full_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'poly_pred'</span>] <span class="op">=</span> poly_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plt.plot(final_df, label<span class="op">=</span>final_df.columns)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="153">
<pre><code>&lt;matplotlib.legend.Legend at 0x7fec1c8643a0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-59-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>lag_df <span class="op">=</span> lag_df.interpolate(limit_direction<span class="op">=</span><span class="st">'backward'</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>split_train_df, split_test_df <span class="op">=</span> train_test_split(lag_df, train_size <span class="op">=</span><span class="fl">0.7</span>, <span class="op">\</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                                                shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>split_train_target <span class="op">=</span> split_train_df[<span class="st">'rmssd'</span>]</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>split_test_target <span class="op">=</span> split_test_df[<span class="st">'rmssd'</span>]</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>split_train_feature <span class="op">=</span> split_train_df.drop(columns<span class="op">=</span><span class="st">'rmssd'</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>split_test_feature <span class="op">=</span> split_test_df.drop(columns<span class="op">=</span><span class="st">'rmssd'</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>poly_test_index <span class="op">=</span> split_test_target.index</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>poly_split_train_feature <span class="op">=</span> poly.fit_transform(split_train_feature)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>poly_split_test_feature <span class="op">=</span> poly.fit_transform(split_test_feature)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>split_poly_model <span class="op">=</span> LinearRegression()</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>split_poly_model.fit(poly_split_train_feature, split_train_target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="155">
<pre><code>LinearRegression()</code></pre>
</div>
</div>
<div class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>poly_result <span class="op">=</span> lag_df.copy()</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>_tmp <span class="op">=</span> poly_result.drop(columns<span class="op">=</span><span class="st">'rmssd'</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>poly_tmp <span class="op">=</span> poly.fit_transform(_tmp)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>poly_random_pred <span class="op">=</span> split_poly_model.predict(poly_tmp)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>poly_result[<span class="st">'poly_random_pred'</span>] <span class="op">=</span> poly_random_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>plt.plot(poly_result[[<span class="st">'rmssd'</span>, <span class="st">'poly_random_pred'</span>]], label<span class="op">=</span>[<span class="st">'rmssd'</span>, <span class="op">\</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">'poly_random_pred'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>poly_random_test_pred <span class="op">=</span> split_poly_model.predict(poly_split_test_feature)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>split_poly_model.score(poly_split_test_feature, split_test_target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="158">
<pre><code>-2.495331857841156</code></pre>
</div>
</div>
<div class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>metrics.mean_squared_error(split_test_target, poly_random_test_pred, squared<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="159">
<pre><code>17.981491923530402</code></pre>
</div>
</div>
<div class="cell" data-execution_count="160">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plt.plot(lag_df[<span class="st">'rmssd'</span>])</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>plt.plot(lag_df[<span class="st">'hrv_rolling'</span>])</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(poly_test_index, poly_random_test_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="160">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7fec1c88b9a0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-66-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Dissapointing results, the prediction is way off.</p>
<section id="stochastic-grafient-decent-regressor" class="level2">
<h2 class="anchored" data-anchor-id="stochastic-grafient-decent-regressor">Stochastic Grafient Decent Regressor</h2>
<div class="cell" data-execution_count="161">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>sgd_model <span class="op">=</span> SGDRegressor(learning_rate <span class="op">=</span> <span class="st">'constant'</span>, eta0 <span class="op">=</span> <span class="fl">0.00000000000000000005</span>, verbose<span class="op">=</span><span class="dv">0</span>, max_iter <span class="op">=</span> <span class="dv">1000</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>sgd_model.fit(X <span class="op">=</span> poly_split_train_feature, y <span class="op">=</span> split_train_target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/shiya/anaconda3/lib/python3.9/site-packages/sklearn/linear_model/_stochastic_gradient.py:1503: ConvergenceWarning: Maximum number of iteration reached before convergence. Consider increasing max_iter to improve the fit.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="161">
<pre><code>SGDRegressor(eta0=5e-20, learning_rate='constant')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>sgd_result <span class="op">=</span> lag_df.copy()</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>sgd_tmp <span class="op">=</span> sgd_result.drop(columns<span class="op">=</span><span class="st">'rmssd'</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>display(sgd_tmp)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>sgd_tmp <span class="op">=</span> poly.fit_transform(sgd_tmp)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>sgd_random_pred <span class="op">=</span> sgd_model.predict(sgd_tmp)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>poly_result[<span class="st">'sgd_random_pred'</span>] <span class="op">=</span> sgd_random_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>nremhr</th>
      <th>entropy</th>
      <th>hrv_rolling</th>
      <th>steps</th>
      <th>steps_normalized</th>
      <th>steps_rolling</th>
      <th>minutesAsleep</th>
      <th>minutesAsleep_normalized</th>
      <th>minutesAsleep_rolling</th>
      <th>Fat_burn_minutes</th>
      <th>...</th>
      <th>rmssd_lag1</th>
      <th>rmssd_lag2</th>
      <th>rmssd_lag3</th>
      <th>rmssd_lag4</th>
      <th>rmssd_lag5</th>
      <th>rmssd_lag6</th>
      <th>rmssd_lag7</th>
      <th>rmssd_lag8</th>
      <th>rmssd_lag9</th>
      <th>rmssd_lag10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-27</th>
      <td>53.789</td>
      <td>2.833</td>
      <td>57.290750</td>
      <td>2542</td>
      <td>25.42</td>
      <td>65.727500</td>
      <td>395</td>
      <td>39.5</td>
      <td>35.950000</td>
      <td>49.0</td>
      <td>...</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>49.983</td>
      <td>2.935</td>
      <td>56.829000</td>
      <td>6426</td>
      <td>64.26</td>
      <td>74.984000</td>
      <td>328</td>
      <td>32.8</td>
      <td>34.500000</td>
      <td>74.0</td>
      <td>...</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>50.798</td>
      <td>2.943</td>
      <td>57.001500</td>
      <td>9602</td>
      <td>96.02</td>
      <td>73.248333</td>
      <td>321</td>
      <td>32.1</td>
      <td>35.333333</td>
      <td>301.0</td>
      <td>...</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>54.837</td>
      <td>2.829</td>
      <td>56.220143</td>
      <td>7721</td>
      <td>77.21</td>
      <td>65.765714</td>
      <td>394</td>
      <td>39.4</td>
      <td>38.057143</td>
      <td>63.0</td>
      <td>...</td>
      <td>59.392</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-03</th>
      <td>52.368</td>
      <td>2.927</td>
      <td>58.457857</td>
      <td>11201</td>
      <td>112.01</td>
      <td>66.738571</td>
      <td>287</td>
      <td>28.7</td>
      <td>39.114286</td>
      <td>134.0</td>
      <td>...</td>
      <td>56.437</td>
      <td>59.392</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-31</th>
      <td>56.233</td>
      <td>2.883</td>
      <td>54.501571</td>
      <td>2925</td>
      <td>29.25</td>
      <td>36.010000</td>
      <td>425</td>
      <td>42.5</td>
      <td>49.257143</td>
      <td>48.0</td>
      <td>...</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
      <td>59.480</td>
      <td>56.305</td>
    </tr>
    <tr>
      <th>2022-06-01</th>
      <td>52.769</td>
      <td>2.938</td>
      <td>54.392000</td>
      <td>15028</td>
      <td>150.28</td>
      <td>33.932857</td>
      <td>334</td>
      <td>33.4</td>
      <td>49.942857</td>
      <td>519.0</td>
      <td>...</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
      <td>59.480</td>
    </tr>
    <tr>
      <th>2022-06-02</th>
      <td>56.017</td>
      <td>2.938</td>
      <td>52.701833</td>
      <td>563</td>
      <td>5.63</td>
      <td>37.328333</td>
      <td>573</td>
      <td>57.3</td>
      <td>50.433333</td>
      <td>3.0</td>
      <td>...</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
      <td>65.393</td>
    </tr>
    <tr>
      <th>2022-06-03</th>
      <td>54.560</td>
      <td>2.840</td>
      <td>52.187200</td>
      <td>3215</td>
      <td>32.15</td>
      <td>43.846000</td>
      <td>619</td>
      <td>61.9</td>
      <td>49.560000</td>
      <td>187.0</td>
      <td>...</td>
      <td>51.455</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
      <td>42.069</td>
    </tr>
    <tr>
      <th>2022-06-04</th>
      <td>55.384</td>
      <td>2.882</td>
      <td>53.317750</td>
      <td>192</td>
      <td>1.92</td>
      <td>47.495000</td>
      <td>527</td>
      <td>52.7</td>
      <td>51.325000</td>
      <td>0.0</td>
      <td>...</td>
      <td>52.935</td>
      <td>51.455</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>77.557</td>
      <td>60.643</td>
    </tr>
  </tbody>
</table>
<p>92 rows Ã— 83 columns</p>
</div>
</div>
</div>
</section>
<section id="plot-for-stochastic-gradient-descent-regressor" class="level2">
<h2 class="anchored" data-anchor-id="plot-for-stochastic-gradient-descent-regressor">Plot for Stochastic Gradient Descent Regressor</h2>
<div class="cell" data-execution_count="163">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>plt.plot(poly_result[[<span class="st">'rmssd'</span>, <span class="st">'hrv_rolling'</span>]], <span class="op">\</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>         label <span class="op">=</span> [<span class="st">'rmssd'</span>, <span class="st">'hrv_rolling'</span>])</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(poly_result.index, poly_result[<span class="st">'sgd_random_pred'</span>])</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.plot(poly_result['poly_random_pred'], label = ['poly_random_pred'])</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="163">
<pre><code>&lt;matplotlib.legend.Legend at 0x7fec1d107430&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-69-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The prediction kind of makes sense, one downward trend predicted, but way off in the beginning and end.</p>
</section>
<section id="using-autogluon-a-package-that-test-multiple-models-including-ensemble-models-which-takes-the-average-of-combined-models." class="level2">
<h2 class="anchored" data-anchor-id="using-autogluon-a-package-that-test-multiple-models-including-ensemble-models-which-takes-the-average-of-combined-models.">Using autogluon, a package that test multiple models, including ensemble models, which takes the average of combined models.</h2>
<div class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>_lag_df <span class="op">=</span> lag_df.drop(columns <span class="op">=</span> [<span class="st">'nremhr'</span>, <span class="st">'entropy'</span>, <span class="st">'hrv_rolling'</span>, <span class="st">'steps_normalized'</span>, <span class="op">\</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'steps_rolling'</span>, <span class="st">'minutesAsleep_normalized'</span>, <span class="st">'minutesAsleep_rolling'</span>])</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>gluon_train, gluon_test <span class="op">=</span> train_test_split(_lag_df, train_size<span class="op">=</span><span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>gluon_data <span class="op">=</span> TabularDataset(gluon_train)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>gluon_predictor <span class="op">=</span> TabularPredictor(label<span class="op">=</span><span class="st">'rmssd'</span>).fit(gluon_data, presets<span class="op">=</span><span class="st">'best_quality'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No path specified. Models will be saved in: "AutogluonModels/ag-20220608_201445/"
Presets specified: ['best_quality']
Beginning AutoGluon training ...
AutoGluon will save models to "AutogluonModels/ag-20220608_201445/"
AutoGluon Version:  0.4.0
Python Version:     3.9.7
Operating System:   Linux
Train Data Rows:    64
Train Data Columns: 76
Label Column: rmssd
Preprocessing data ...
AutoGluon infers your prediction problem is: 'regression' (because dtype of label-column == float and many unique label-values observed).
    Label info (max, min, mean, stddev): (77.557, 36.699, 56.25394, 9.10577)
    If 'regression' is not the correct problem_type, please manually specify the problem_type parameter during predictor init (You may specify problem_type as one of: ['binary', 'multiclass', 'regression'])
Using Feature Generators to preprocess the data ...
Fitting AutoMLPipelineFeatureGenerator...
    Available Memory:                    3719.98 MB
    Train Data (Original)  Memory Usage: 0.04 MB (0.0% of available memory)
    Inferring data type of each feature based on column values. Set feature_metadata_in to manually specify special dtypes of the features.
    Stage 1 Generators:
        Fitting AsTypeFeatureGenerator...
    Stage 2 Generators:
        Fitting FillNaFeatureGenerator...
    Stage 3 Generators:
        Fitting IdentityFeatureGenerator...
    Stage 4 Generators:
        Fitting DropUniqueFeatureGenerator...
    Types of features in original data (raw dtype, special dtypes):
        ('float', []) : 74 | ['Fat_burn_minutes', 'Cardio_minutes', 'Peak_minutes', 'Resting_minutes', 'steps_lag1', ...]
        ('int', [])   :  2 | ['steps', 'minutesAsleep']
    Types of features in processed data (raw dtype, special dtypes):
        ('float', []) : 74 | ['Fat_burn_minutes', 'Cardio_minutes', 'Peak_minutes', 'Resting_minutes', 'steps_lag1', ...]
        ('int', [])   :  2 | ['steps', 'minutesAsleep']
    0.1s = Fit runtime
    76 features in original data used to generate 76 features in processed data.
    Train Data (Processed) Memory Usage: 0.04 MB (0.0% of available memory)
Data preprocessing and feature engineering runtime = 0.09s ...
AutoGluon will gauge predictive performance using evaluation metric: 'root_mean_squared_error'
    To change this, specify the eval_metric parameter of Predictor()
Fitting 11 L1 models ...
Fitting model: KNeighborsUnif_BAG_L1 ...
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
    -9.348   = Validation score   (root_mean_squared_error)
    0.01s    = Training   runtime
    0.0s     = Validation runtime
Fitting model: KNeighborsDist_BAG_L1 ...
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
    -9.3972  = Validation score   (root_mean_squared_error)
    0.01s    = Training   runtime
    0.0s     = Validation runtime
Fitting model: LightGBMXT_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -8.4466  = Validation score   (root_mean_squared_error)
    2.74s    = Training   runtime
    0.01s    = Validation runtime
Fitting model: LightGBM_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -8.5902  = Validation score   (root_mean_squared_error)
    2.93s    = Training   runtime
    0.01s    = Validation runtime
Fitting model: RandomForestMSE_BAG_L1 ...
    -9.0045  = Validation score   (root_mean_squared_error)
    0.51s    = Training   runtime
    0.08s    = Validation runtime
Fitting model: CatBoost_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -8.5633  = Validation score   (root_mean_squared_error)
    5.65s    = Training   runtime
    0.01s    = Validation runtime
Fitting model: ExtraTreesMSE_BAG_L1 ...
    -8.9012  = Validation score   (root_mean_squared_error)
    0.44s    = Training   runtime
    0.07s    = Validation runtime
Fitting model: NeuralNetFastAI_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    Warning: Exception caused NeuralNetFastAI_BAG_L1 to fail during training (ImportError)... Skipping this model.
        ray::_ray_fit() (pid=7326, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/fastainn/imports_helper.py", line 1, in &lt;module&gt;
    from fastai.tabular.all import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/tabular/all.py", line 1, in &lt;module&gt;
    from ..basics import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/basics.py", line 1, in &lt;module&gt;
    from .data.all import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/data/all.py", line 1, in &lt;module&gt;
    from ..torch_basics import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/torch_basics.py", line 1, in &lt;module&gt;
    from torch import multiprocessing
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/multiprocessing/__init__.py", line 18, in &lt;module&gt;
    from .reductions import init_reductions
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/multiprocessing/reductions.py", line 2, in &lt;module&gt;
    import torch.utils.hooks
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/utils/__init__.py", line 4, in &lt;module&gt;
    from .throughput_benchmark import ThroughputBenchmark
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/utils/throughput_benchmark.py", line 2, in &lt;module&gt;
    import torch._C
ModuleNotFoundError: No module named 'torch._C'

During handling of the above exception, another exception occurred:

ray::_ray_fit() (pid=7326, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 288, in _ray_fit
    fold_model.fit(X=X_fold, y=y_fold, X_val=X_val_fold, y_val=y_val_fold,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/fastainn/tabular_nn_fastai.py", line 169, in _fit
    try_import_fastai()
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/utils/try_import.py", line 131, in try_import_fastai
    raise ImportError("Import fastai failed. A quick tip is to install via `pip install fastai==2.*`. "
ImportError: Import fastai failed. A quick tip is to install via `pip install fastai==2.*`. If you are using Mac OSX, please use this torch version to avoid compatibility issues: `pip install torch==1.6.0`.
Fitting model: XGBoost_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -9.0066  = Validation score   (root_mean_squared_error)
    0.69s    = Training   runtime
    0.03s    = Validation runtime
Fitting model: NeuralNetTorch_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    Warning: Exception caused NeuralNetTorch_BAG_L1 to fail during training... Skipping this model.
        ray::_ray_fit() (pid=7676, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 288, in _ray_fit
    fold_model.fit(X=X_fold, y=y_fold, X_val=X_val_fold, y_val=y_val_fold,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/tabular_nn/torch/tabular_nn_torch.py", line 142, in _fit
    torch.set_num_threads(num_cpus)
AttributeError: module 'torch' has no attribute 'set_num_threads'
Detailed Traceback:
Traceback (most recent call last):
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/trainer/abstract_trainer.py", line 1074, in _train_and_save
    model = self._train_single(X, y, model, X_val, y_val, **model_fit_kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/trainer/abstract_trainer.py", line 1032, in _train_single
    model = model.fit(X=X, y=y, X_val=X_val, y_val=y_val, **model_fit_kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/stacker_ensemble_model.py", line 153, in _fit
    return super()._fit(X=X, y=y, time_limit=time_limit, **kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/bagged_ensemble_model.py", line 211, in _fit
    self._fit_folds(X=X, y=y, model_base=model_base, X_pseudo=X_pseudo, y_pseudo=y_pseudo,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/bagged_ensemble_model.py", line 481, in _fit_folds
    fold_fitting_strategy.after_all_folds_scheduled()
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 455, in after_all_folds_scheduled
    raise processed_exception
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 423, in after_all_folds_scheduled
    time_end_fit, predict_time, predict_1_time = self.ray.get(finished)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/ray/_private/client_mode_hook.py", line 105, in wrapper
    return func(*args, **kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/ray/worker.py", line 1625, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(AttributeError): ray::_ray_fit() (pid=7676, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 288, in _ray_fit
    fold_model.fit(X=X_fold, y=y_fold, X_val=X_val_fold, y_val=y_val_fold,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/tabular_nn/torch/tabular_nn_torch.py", line 142, in _fit
    torch.set_num_threads(num_cpus)
AttributeError: module 'torch' has no attribute 'set_num_threads'
Fitting model: LightGBMLarge_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -8.7106  = Validation score   (root_mean_squared_error)
    4.41s    = Training   runtime
    0.03s    = Validation runtime
Fitting model: WeightedEnsemble_L2 ...
    -8.3209  = Validation score   (root_mean_squared_error)
    0.24s    = Training   runtime
    0.0s     = Validation runtime
AutoGluon training complete, total runtime = 29.96s ... Best model: "WeightedEnsemble_L2"
TabularPredictor saved. To load, use: predictor = TabularPredictor.load("AutogluonModels/ag-20220608_201445/")</code></pre>
</div>
</div>
<div class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>gluon_prediction <span class="op">=</span> gluon_predictor.predict(lag_df)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>gluon_test_prediction <span class="op">=</span> gluon_predictor.predict(gluon_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>gluon_prediction_index <span class="op">=</span> gluon_test.index</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>gluon_prediction_df <span class="op">=</span> gluon_test_prediction</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>gluon_prediction_df.index <span class="op">=</span> gluon_prediction_index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-before-dropping-uninportant-features" class="level2">
<h2 class="anchored" data-anchor-id="plot-before-dropping-uninportant-features">Plot before dropping uninportant features</h2>
<div class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>plt.plot(lag_df[<span class="st">'rmssd'</span>])</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>plt.plot(lag_df[<span class="st">'hrv_rolling'</span>])</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(gluon_test_prediction.index, gluon_test_prediction.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="168">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7fece22b4ee0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-74-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Lowest rmssd was taken to be the average of HRV or overall period, gave up on predicting trend.</p>
<div class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>gluon_predictor.evaluate(gluon_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Evaluation: root_mean_squared_error on test data: -7.405250305322229
    Note: Scores are always higher_is_better. This metric score can be multiplied by -1 to get the metric value.
Evaluations on test data:
{
    "root_mean_squared_error": -7.405250305322229,
    "mean_squared_error": -54.83773208447496,
    "mean_absolute_error": -5.86920223236084,
    "r2": -0.11605903107403015,
    "pearsonr": -0.002697837804629205,
    "median_absolute_error": -3.5830870971679687
}</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="169">
<pre><code>{'root_mean_squared_error': -7.405250305322229,
 'mean_squared_error': -54.83773208447496,
 'mean_absolute_error': -5.86920223236084,
 'r2': -0.11605903107403015,
 'pearsonr': -0.002697837804629205,
 'median_absolute_error': -3.5830870971679687}</code></pre>
</div>
</div>
</section>
<section id="attempt-on-discarding-unimportant-features-importance-0-and-p-value-0.5." class="level2">
<h2 class="anchored" data-anchor-id="attempt-on-discarding-unimportant-features-importance-0-and-p-value-0.5.">Attempt on discarding unimportant features (importance &lt; 0 and p-value &gt; 0.5).</h2>
<p>gluon_feature_summary = gluon_predictor.feature_importance(gluon_test)</p>
<div class="cell" data-execution_count="170">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>gluon_feature_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="170">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>importance</th>
      <th>stddev</th>
      <th>p_value</th>
      <th>n</th>
      <th>p99_high</th>
      <th>p99_low</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>minutesAsleep_lag3</th>
      <td>0.249560</td>
      <td>0.023503</td>
      <td>0.001472</td>
      <td>3</td>
      <td>0.384233</td>
      <td>0.114888</td>
    </tr>
    <tr>
      <th>Cardio_minutes</th>
      <td>0.109991</td>
      <td>0.040315</td>
      <td>0.020990</td>
      <td>3</td>
      <td>0.340998</td>
      <td>-0.121016</td>
    </tr>
    <tr>
      <th>minutesAsleep</th>
      <td>0.044914</td>
      <td>0.041299</td>
      <td>0.100151</td>
      <td>3</td>
      <td>0.281563</td>
      <td>-0.191735</td>
    </tr>
    <tr>
      <th>minutesAsleep_lag6</th>
      <td>0.042527</td>
      <td>0.021470</td>
      <td>0.037733</td>
      <td>3</td>
      <td>0.165552</td>
      <td>-0.080497</td>
    </tr>
    <tr>
      <th>rmssd_lag10</th>
      <td>0.038211</td>
      <td>0.016975</td>
      <td>0.029964</td>
      <td>3</td>
      <td>0.135478</td>
      <td>-0.059056</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Resting_minutes_lag5</th>
      <td>-0.054822</td>
      <td>0.024467</td>
      <td>0.969781</td>
      <td>3</td>
      <td>0.085377</td>
      <td>-0.195020</td>
    </tr>
    <tr>
      <th>Fat_burn_minutes_lag2</th>
      <td>-0.055664</td>
      <td>0.012139</td>
      <td>0.992257</td>
      <td>3</td>
      <td>0.013896</td>
      <td>-0.125224</td>
    </tr>
    <tr>
      <th>Peak_minutes_lag3</th>
      <td>-0.078832</td>
      <td>0.054842</td>
      <td>0.934759</td>
      <td>3</td>
      <td>0.235416</td>
      <td>-0.393081</td>
    </tr>
    <tr>
      <th>Peak_minutes_lag1</th>
      <td>-0.088884</td>
      <td>0.016853</td>
      <td>0.994114</td>
      <td>3</td>
      <td>0.007685</td>
      <td>-0.185453</td>
    </tr>
    <tr>
      <th>rmssd_lag9</th>
      <td>-0.126824</td>
      <td>0.050599</td>
      <td>0.975412</td>
      <td>3</td>
      <td>0.163111</td>
      <td>-0.416760</td>
    </tr>
  </tbody>
</table>
<p>76 rows Ã— 6 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="171">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>useless_columns <span class="op">=</span> gluon_feature_summary<span class="op">\</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>                [(gluon_feature_summary[<span class="st">'importance'</span>] <span class="op">&lt;</span> <span class="dv">0</span>) <span class="op">\</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span> (gluon_feature_summary[<span class="st">'p_value'</span>]<span class="op">&gt;</span> <span class="fl">0.5</span>)].index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="172">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>useless_columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="172">
<pre><code>Index(['Resting_minutes_lag7', 'minutesAsleep_lag5', 'rmssd_lag5',
       'Peak_minutes_lag4', 'Peak_minutes_lag8', 'rmssd_lag7',
       'Resting_minutes_lag2', 'Cardio_minutes_lag8', 'rmssd_lag2',
       'Cardio_minutes_lag9', 'Cardio_minutes_lag1', 'rmssd_lag6',
       'Fat_burn_minutes_lag4', 'Fat_burn_minutes_lag3', 'steps_lag5',
       'Peak_minutes_lag9', 'Fat_burn_minutes_lag9', 'Fat_burn_minutes_lag1',
       'Fat_burn_minutes_lag7', 'steps_lag4', 'Cardio_minutes_lag3',
       'Peak_minutes_lag6', 'steps_lag7', 'rmssd_lag8', 'Resting_minutes_lag9',
       'Resting_minutes_lag1', 'Cardio_minutes_lag7', 'Cardio_minutes_lag6',
       'Cardio_minutes_lag4', 'Peak_minutes_lag2', 'minutesAsleep_lag2',
       'Cardio_minutes_lag2', 'steps', 'steps_lag10', 'Cardio_minutes_lag10',
       'Resting_minutes_lag5', 'Fat_burn_minutes_lag2', 'Peak_minutes_lag3',
       'Peak_minutes_lag1', 'rmssd_lag9'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="173">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>_dropped_df <span class="op">=</span> _lag_df.copy()</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> useless_columns:</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    _dropped_df.drop(columns<span class="op">=</span>col, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="174">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>_dropped_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="174">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>rmssd</th>
      <th>minutesAsleep</th>
      <th>Fat_burn_minutes</th>
      <th>Cardio_minutes</th>
      <th>Peak_minutes</th>
      <th>Resting_minutes</th>
      <th>steps_lag1</th>
      <th>steps_lag2</th>
      <th>steps_lag3</th>
      <th>steps_lag6</th>
      <th>...</th>
      <th>Peak_minutes_lag7</th>
      <th>Peak_minutes_lag10</th>
      <th>Fat_burn_minutes_lag5</th>
      <th>Fat_burn_minutes_lag6</th>
      <th>Fat_burn_minutes_lag8</th>
      <th>Fat_burn_minutes_lag10</th>
      <th>rmssd_lag1</th>
      <th>rmssd_lag3</th>
      <th>rmssd_lag4</th>
      <th>rmssd_lag10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-27</th>
      <td>52.053</td>
      <td>395</td>
      <td>49.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1375.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-02-28</th>
      <td>61.281</td>
      <td>328</td>
      <td>74.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1327.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>59.392</td>
      <td>321</td>
      <td>301.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1133.0</td>
      <td>6426.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-02</th>
      <td>56.437</td>
      <td>394</td>
      <td>63.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1318.0</td>
      <td>9602.0</td>
      <td>6426.0</td>
      <td>2542.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>59.392</td>
      <td>52.053</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>2022-03-03</th>
      <td>54.982</td>
      <td>287</td>
      <td>134.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1261.0</td>
      <td>7721.0</td>
      <td>9602.0</td>
      <td>6426.0</td>
      <td>2542.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>56.437</td>
      <td>61.281</td>
      <td>52.053</td>
      <td>52.053</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-31</th>
      <td>47.665</td>
      <td>425</td>
      <td>48.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1199.0</td>
      <td>474.0</td>
      <td>1356.0</td>
      <td>1646.0</td>
      <td>1245.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>220.0</td>
      <td>54.0</td>
      <td>273.0</td>
      <td>55.275</td>
      <td>53.198</td>
      <td>64.780</td>
      <td>56.305</td>
    </tr>
    <tr>
      <th>2022-06-01</th>
      <td>56.450</td>
      <td>334</td>
      <td>519.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>908.0</td>
      <td>2925.0</td>
      <td>474.0</td>
      <td>1356.0</td>
      <td>1868.0</td>
      <td>...</td>
      <td>8.0</td>
      <td>0.0</td>
      <td>60.0</td>
      <td>24.0</td>
      <td>13.0</td>
      <td>135.0</td>
      <td>47.665</td>
      <td>64.533</td>
      <td>53.198</td>
      <td>59.480</td>
    </tr>
    <tr>
      <th>2022-06-02</th>
      <td>51.455</td>
      <td>573</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>862.0</td>
      <td>15028.0</td>
      <td>2925.0</td>
      <td>474.0</td>
      <td>2765.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>17.0</td>
      <td>60.0</td>
      <td>220.0</td>
      <td>54.0</td>
      <td>56.450</td>
      <td>55.275</td>
      <td>64.533</td>
      <td>65.393</td>
    </tr>
    <tr>
      <th>2022-06-03</th>
      <td>52.935</td>
      <td>619</td>
      <td>187.0</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>1044.0</td>
      <td>563.0</td>
      <td>15028.0</td>
      <td>2925.0</td>
      <td>1646.0</td>
      <td>...</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>17.0</td>
      <td>24.0</td>
      <td>13.0</td>
      <td>51.455</td>
      <td>47.665</td>
      <td>55.275</td>
      <td>42.069</td>
    </tr>
    <tr>
      <th>2022-06-04</th>
      <td>52.431</td>
      <td>527</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>647.0</td>
      <td>3215.0</td>
      <td>563.0</td>
      <td>15028.0</td>
      <td>1356.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>60.0</td>
      <td>220.0</td>
      <td>52.935</td>
      <td>56.450</td>
      <td>47.665</td>
      <td>60.643</td>
    </tr>
  </tbody>
</table>
<p>92 rows Ã— 37 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="175">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>dropped_train, dropped_test <span class="op">=</span> train_test_split(_dropped_df, train_size <span class="op">=</span> <span class="fl">0.8</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>dropped_gluon_data <span class="op">=</span> TabularDataset(dropped_train)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>dropped_gluon_predictor <span class="op">=</span> TabularPredictor(label<span class="op">=</span><span class="st">'rmssd'</span>).fit(dropped_gluon_data, presets<span class="op">=</span><span class="st">'best_quality'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No path specified. Models will be saved in: "AutogluonModels/ag-20220608_201516/"
Presets specified: ['best_quality']
Beginning AutoGluon training ...
AutoGluon will save models to "AutogluonModels/ag-20220608_201516/"
AutoGluon Version:  0.4.0
Python Version:     3.9.7
Operating System:   Linux
Train Data Rows:    73
Train Data Columns: 36
Label Column: rmssd
Preprocessing data ...
AutoGluon infers your prediction problem is: 'regression' (because dtype of label-column == float and many unique label-values observed).
    Label info (max, min, mean, stddev): (77.557, 36.699, 57.41392, 8.5538)
    If 'regression' is not the correct problem_type, please manually specify the problem_type parameter during predictor init (You may specify problem_type as one of: ['binary', 'multiclass', 'regression'])
Using Feature Generators to preprocess the data ...
Fitting AutoMLPipelineFeatureGenerator...
    Available Memory:                    3677.57 MB
    Train Data (Original)  Memory Usage: 0.02 MB (0.0% of available memory)
    Inferring data type of each feature based on column values. Set feature_metadata_in to manually specify special dtypes of the features.
    Stage 1 Generators:
        Fitting AsTypeFeatureGenerator...
    Stage 2 Generators:
        Fitting FillNaFeatureGenerator...
    Stage 3 Generators:
        Fitting IdentityFeatureGenerator...
    Stage 4 Generators:
        Fitting DropUniqueFeatureGenerator...
    Types of features in original data (raw dtype, special dtypes):
        ('float', []) : 35 | ['Fat_burn_minutes', 'Cardio_minutes', 'Peak_minutes', 'Resting_minutes', 'steps_lag1', ...]
        ('int', [])   :  1 | ['minutesAsleep']
    Types of features in processed data (raw dtype, special dtypes):
        ('float', []) : 35 | ['Fat_burn_minutes', 'Cardio_minutes', 'Peak_minutes', 'Resting_minutes', 'steps_lag1', ...]
        ('int', [])   :  1 | ['minutesAsleep']
    0.0s = Fit runtime
    36 features in original data used to generate 36 features in processed data.
    Train Data (Processed) Memory Usage: 0.02 MB (0.0% of available memory)
Data preprocessing and feature engineering runtime = 0.06s ...
AutoGluon will gauge predictive performance using evaluation metric: 'root_mean_squared_error'
    To change this, specify the eval_metric parameter of Predictor()
Fitting 11 L1 models ...
Fitting model: KNeighborsUnif_BAG_L1 ...
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
    -9.07    = Validation score   (root_mean_squared_error)
    0.01s    = Training   runtime
    0.0s     = Validation runtime
Fitting model: KNeighborsDist_BAG_L1 ...
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
    -9.0758  = Validation score   (root_mean_squared_error)
    0.01s    = Training   runtime
    0.0s     = Validation runtime
Fitting model: LightGBMXT_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -7.9723  = Validation score   (root_mean_squared_error)
    2.38s    = Training   runtime
    0.01s    = Validation runtime
Fitting model: LightGBM_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -8.178   = Validation score   (root_mean_squared_error)
    2.51s    = Training   runtime
    0.01s    = Validation runtime
Fitting model: RandomForestMSE_BAG_L1 ...
    -8.6463  = Validation score   (root_mean_squared_error)
    0.41s    = Training   runtime
    0.07s    = Validation runtime
Fitting model: CatBoost_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -7.8032  = Validation score   (root_mean_squared_error)
    3.19s    = Training   runtime
    0.01s    = Validation runtime
Fitting model: ExtraTreesMSE_BAG_L1 ...
    -8.3298  = Validation score   (root_mean_squared_error)
    0.43s    = Training   runtime
    0.1s     = Validation runtime
Fitting model: NeuralNetFastAI_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    Warning: Exception caused NeuralNetFastAI_BAG_L1 to fail during training (ImportError)... Skipping this model.
        ray::_ray_fit() (pid=8377, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/fastainn/imports_helper.py", line 1, in &lt;module&gt;
    from fastai.tabular.all import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/tabular/all.py", line 1, in &lt;module&gt;
    from ..basics import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/basics.py", line 1, in &lt;module&gt;
    from .data.all import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/data/all.py", line 1, in &lt;module&gt;
    from ..torch_basics import *
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/fastai/torch_basics.py", line 1, in &lt;module&gt;
    from torch import multiprocessing
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/multiprocessing/__init__.py", line 18, in &lt;module&gt;
    from .reductions import init_reductions
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/multiprocessing/reductions.py", line 2, in &lt;module&gt;
    import torch.utils.hooks
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/utils/__init__.py", line 4, in &lt;module&gt;
    from .throughput_benchmark import ThroughputBenchmark
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/torch/utils/throughput_benchmark.py", line 2, in &lt;module&gt;
    import torch._C
ModuleNotFoundError: No module named 'torch._C'

During handling of the above exception, another exception occurred:

ray::_ray_fit() (pid=8377, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 288, in _ray_fit
    fold_model.fit(X=X_fold, y=y_fold, X_val=X_val_fold, y_val=y_val_fold,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/fastainn/tabular_nn_fastai.py", line 169, in _fit
    try_import_fastai()
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/utils/try_import.py", line 131, in try_import_fastai
    raise ImportError("Import fastai failed. A quick tip is to install via `pip install fastai==2.*`. "
ImportError: Import fastai failed. A quick tip is to install via `pip install fastai==2.*`. If you are using Mac OSX, please use this torch version to avoid compatibility issues: `pip install torch==1.6.0`.
Fitting model: XGBoost_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -8.872   = Validation score   (root_mean_squared_error)
    0.58s    = Training   runtime
    0.02s    = Validation runtime
Fitting model: NeuralNetTorch_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    Warning: Exception caused NeuralNetTorch_BAG_L1 to fail during training... Skipping this model.
        ray::_ray_fit() (pid=8691, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 288, in _ray_fit
    fold_model.fit(X=X_fold, y=y_fold, X_val=X_val_fold, y_val=y_val_fold,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/tabular_nn/torch/tabular_nn_torch.py", line 142, in _fit
    torch.set_num_threads(num_cpus)
AttributeError: module 'torch' has no attribute 'set_num_threads'
Detailed Traceback:
Traceback (most recent call last):
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/trainer/abstract_trainer.py", line 1074, in _train_and_save
    model = self._train_single(X, y, model, X_val, y_val, **model_fit_kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/trainer/abstract_trainer.py", line 1032, in _train_single
    model = model.fit(X=X, y=y, X_val=X_val, y_val=y_val, **model_fit_kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/stacker_ensemble_model.py", line 153, in _fit
    return super()._fit(X=X, y=y, time_limit=time_limit, **kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/bagged_ensemble_model.py", line 211, in _fit
    self._fit_folds(X=X, y=y, model_base=model_base, X_pseudo=X_pseudo, y_pseudo=y_pseudo,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/bagged_ensemble_model.py", line 481, in _fit_folds
    fold_fitting_strategy.after_all_folds_scheduled()
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 455, in after_all_folds_scheduled
    raise processed_exception
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 423, in after_all_folds_scheduled
    time_end_fit, predict_time, predict_1_time = self.ray.get(finished)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/ray/_private/client_mode_hook.py", line 105, in wrapper
    return func(*args, **kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/ray/worker.py", line 1625, in get
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(AttributeError): ray::_ray_fit() (pid=8691, ip=192.168.1.205)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/ensemble/fold_fitting_strategy.py", line 288, in _ray_fit
    fold_model.fit(X=X_fold, y=y_fold, X_val=X_val_fold, y_val=y_val_fold,
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/core/models/abstract/abstract_model.py", line 577, in fit
    out = self._fit(**kwargs)
  File "/home/shiya/anaconda3/lib/python3.9/site-packages/autogluon/tabular/models/tabular_nn/torch/tabular_nn_torch.py", line 142, in _fit
    torch.set_num_threads(num_cpus)
AttributeError: module 'torch' has no attribute 'set_num_threads'
Fitting model: LightGBMLarge_BAG_L1 ...
    Fitting 5 child models (S1F1 - S1F5) | Fitting with ParallelLocalFoldFittingStrategy
    -7.9071  = Validation score   (root_mean_squared_error)
    3.64s    = Training   runtime
    0.02s    = Validation runtime
Fitting model: WeightedEnsemble_L2 ...
    -7.7217  = Validation score   (root_mean_squared_error)
    0.22s    = Training   runtime
    0.0s     = Validation runtime
AutoGluon training complete, total runtime = 25.19s ... Best model: "WeightedEnsemble_L2"
TabularPredictor saved. To load, use: predictor = TabularPredictor.load("AutogluonModels/ag-20220608_201516/")</code></pre>
</div>
</div>
<div class="cell" data-execution_count="176">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>dropped_gluon_prediction <span class="op">=</span> dropped_gluon_predictor.predict(lag_df)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>dropped_gluon_test_prediction <span class="op">=</span> dropped_gluon_predictor.predict(dropped_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>dropped_gluon_prediction_index <span class="op">=</span> dropped_test.index</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>dropped_gluon_prediction_df <span class="op">=</span> dropped_gluon_test_prediction</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>dropped_gluon_prediction_df.index <span class="op">=</span> dropped_gluon_prediction_index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prediction-after-dropping-features." class="level2">
<h2 class="anchored" data-anchor-id="prediction-after-dropping-features.">Prediction after dropping features.</h2>
<div class="cell" data-execution_count="178">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>plt.plot(lag_df[<span class="st">'rmssd'</span>])</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>plt.plot(lag_df[<span class="st">'hrv_rolling'</span>])</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(dropped_gluon_test_prediction.index, dropped_gluon_test_prediction.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="178">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7fece2326ee0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="HRV_trend_files/figure-html/cell-84-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Dead end, no idea how to intepret the results.</p>
<div class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>dropped_feature <span class="op">=</span> dropped_gluon_predictor.feature_importance(dropped_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing feature importance via permutation shuffling for 36 features using 19 rows with 3 shuffle sets...
    16.99s  = Expected runtime (5.66s per shuffle set)
    1.54s   = Actual runtime (Completed 3 of 3 shuffle sets)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>dropped_feature.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="180">
<pre><code>Index(['minutesAsleep_lag3', 'Cardio_minutes', 'minutesAsleep_lag7',
       'rmssd_lag3', 'Fat_burn_minutes', 'minutesAsleep', 'minutesAsleep_lag8',
       'minutesAsleep_lag4', 'rmssd_lag1', 'Fat_burn_minutes_lag5',
       'minutesAsleep_lag9', 'rmssd_lag10', 'minutesAsleep_lag6',
       'Resting_minutes_lag6', 'steps_lag6', 'steps_lag2',
       'Resting_minutes_lag3', 'Peak_minutes_lag7', 'Peak_minutes',
       'Fat_burn_minutes_lag8', 'Peak_minutes_lag10', 'Peak_minutes_lag5',
       'Resting_minutes_lag8', 'rmssd_lag4', 'Cardio_minutes_lag5',
       'Resting_minutes', 'Fat_burn_minutes_lag6', 'steps_lag3', 'steps_lag9',
       'steps_lag8', 'minutesAsleep_lag1', 'Fat_burn_minutes_lag10',
       'minutesAsleep_lag10', 'Resting_minutes_lag4', 'Resting_minutes_lag10',
       'steps_lag1'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>dropped_feature</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="181">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>importance</th>
      <th>stddev</th>
      <th>p_value</th>
      <th>n</th>
      <th>p99_high</th>
      <th>p99_low</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>minutesAsleep_lag3</th>
      <td>0.450802</td>
      <td>0.036743</td>
      <td>0.001104</td>
      <td>3</td>
      <td>0.661341</td>
      <td>0.240263</td>
    </tr>
    <tr>
      <th>Cardio_minutes</th>
      <td>0.150156</td>
      <td>0.235763</td>
      <td>0.192477</td>
      <td>3</td>
      <td>1.501102</td>
      <td>-1.200791</td>
    </tr>
    <tr>
      <th>minutesAsleep_lag7</th>
      <td>0.141971</td>
      <td>0.151673</td>
      <td>0.123207</td>
      <td>3</td>
      <td>1.011073</td>
      <td>-0.727132</td>
    </tr>
    <tr>
      <th>rmssd_lag3</th>
      <td>0.136488</td>
      <td>0.127597</td>
      <td>0.102553</td>
      <td>3</td>
      <td>0.867636</td>
      <td>-0.594659</td>
    </tr>
    <tr>
      <th>Fat_burn_minutes</th>
      <td>0.099345</td>
      <td>0.110268</td>
      <td>0.129510</td>
      <td>3</td>
      <td>0.731192</td>
      <td>-0.532502</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Fat_burn_minutes_lag10</th>
      <td>-0.024881</td>
      <td>0.108250</td>
      <td>0.635485</td>
      <td>3</td>
      <td>0.595405</td>
      <td>-0.645167</td>
    </tr>
    <tr>
      <th>minutesAsleep_lag10</th>
      <td>-0.036827</td>
      <td>0.123141</td>
      <td>0.671964</td>
      <td>3</td>
      <td>0.668785</td>
      <td>-0.742438</td>
    </tr>
    <tr>
      <th>Resting_minutes_lag4</th>
      <td>-0.041230</td>
      <td>0.090206</td>
      <td>0.744232</td>
      <td>3</td>
      <td>0.475661</td>
      <td>-0.558121</td>
    </tr>
    <tr>
      <th>Resting_minutes_lag10</th>
      <td>-0.047640</td>
      <td>0.026405</td>
      <td>0.955523</td>
      <td>3</td>
      <td>0.103666</td>
      <td>-0.198945</td>
    </tr>
    <tr>
      <th>steps_lag1</th>
      <td>-0.078301</td>
      <td>0.062259</td>
      <td>0.919371</td>
      <td>3</td>
      <td>0.278453</td>
      <td>-0.435055</td>
    </tr>
  </tbody>
</table>
<p>36 rows Ã— 6 columns</p>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>